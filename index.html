<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Conference Run of Show</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f9fafc; color: #333; }
    header { background: #2c3e50; color: white; padding: 1rem; text-align: center; }
    nav { margin-top: 1rem; }
    nav button { margin: 0.3rem; padding: 0.6rem 1rem; border: none; background: #3498db; color: white; border-radius: 5px; cursor: pointer; }
    nav button.active { background: #1abc9c; }
    .schedule-day { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    .event { background: white; padding: 1rem; margin: 0.5rem 0; border-left: 5px solid #3498db; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,.1); }
    .event h3 { margin: 0; }
    .event small { color: #777; }
  </style>
</head>
<body>
  <header>
    <h1>Conference Run of Show</h1>
    <nav id="day-nav"></nav>
  </header>
  <main id="schedule"></main>

  <script>
    // ðŸ‘‰ replace this with your Google Apps Script Web App URL
    const sheetUrl = "https://script.googleusercontent.com/a/macros/flexport.com/echo?user_content_key=AehSKLiQNfDEP2dqZl6jX9VnYNcDtCvSciwScIUHDgcMVeVoXakgw7CIyktLH_kgYeLkrnFG7wguyLXXOQYvG13V6Zu74UzgoDhMuphNT-yn8rkJ37VPSp7seYpY-jTP-ZI_IY4gkGhdbTk9KLKt2J2vbLyIIXwH_2L84VAHqI12XlSC1YL422F94E8huqqulkDFGTDczEUongzHOxfxYiBfbJcsAMW9gzgDMN5cZlqQommnb_TfyjId6T8rIx5fNwcU2NZTgtbxW-0JX39QRZg&lib=Moftsz8O_3FnQeQmqW7QGxSuhMqpg5Jk9";

    // Helper to format Excel-ish ISO date strings into nice Times
    function formatTime(value) {
      if (!value || value === "TBD") return "TBD";
      try {
        const date = new Date(value);
        if (!isNaN(date.getTime())) {
          return date.toLocaleTimeString([], {hour: 'numeric', minute:'2-digit'});
        }
      } catch(e) {}
      return value; // fallback
    }

    function formatDate(value) {
      try {
        const d = new Date(value);
        if (!isNaN(d.getTime())) {
          return d.toLocaleDateString("en-US", {weekday:'long', month:'long', day:'numeric', year:'numeric'});
        }
      } catch(e) {}
      return value;
    }

    async function loadData() {
      const response = await fetch(sheetUrl);
      const data = await response.json();

      // Group by Date
      const grouped = {};
      data.forEach(evt => {
        const day = formatDate(evt["Date"]);
        if (!grouped[day]) grouped[day] = [];
        grouped[day].push(evt);
      });

      const dayNav = document.getElementById("day-nav");
      dayNav.innerHTML = "";

      Object.keys(grouped).forEach((day, index) => {
        const btn = document.createElement("button");
        btn.textContent = day;
        btn.onclick = () => showDay(day, grouped);
        if (index === 0) btn.classList.add("active");
        dayNav.appendChild(btn);
      });

      showDay(Object.keys(grouped)[0], grouped);
    }

    function showDay(day, grouped) {
      const schedule = document.getElementById("schedule");
      schedule.innerHTML = `<h2>${day}</h2>`;

      document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));
      [...document.querySelectorAll("nav button")].find(btn => btn.textContent === day).classList.add("active");

      const container = document.createElement("div");
      container.classList.add("schedule-day");

      grouped[day].forEach(evt => {
        const div = document.createElement("div");
        div.classList.add("event");
        div.innerHTML = `
          <h3>${evt["Item"] || "(No Title)"}</h3>
          <small>${formatTime(evt["Start Time"])}${evt["End Time"] ? " - " + formatTime(evt["End Time"]) : ""}</small>
          <p><strong>Speakers:</strong> ${evt["Speaker / Support"] || "N/A"}</p>
          <p><strong>Type:</strong> ${evt["Session Type"] || "N/A"}</p>
          <p><strong>Location:</strong> ${evt["Location"] || "N/A"}</p>
          <p><strong>Owner:</strong> ${evt["POC"] || "N/A"}</p>
          <p><strong>Notes:</strong> ${evt["Cue / Notes"] || ""}</p>
        `;
        container.appendChild(div);
      });

      schedule.appendChild(container);
    }

    loadData();
  </script>
</body>
</html>
